Job ID: 67195
Job Name: resnet_training
Node: b-31-111
GPU: 0
Start Time: Mon Oct  6 09:12:42 PM EDT 2025
Working Directory: /scratch/cx2275/CNN_From_Scratch
Starting Singularity container...
Already up to date.
Python version: Python 3.10.18
PyTorch version: 2.6.0
CUDA available: True
GPU count: 1
GPU name: NVIDIA L4
==========================
Running tests...
Device: cuda
Training set: torch.Size([48000, 1, 28, 28]), torch.Size([48000])
Validation set: torch.Size([12000, 1, 28, 28]), torch.Size([12000])
Test set: torch.Size([10000, 1, 28, 28]), torch.Size([10000])
Device: cuda

[Linear] forward/backward numeric grad...
  max |dL/dx (num - analytic)|: 6.458163261413574e-05
  max |dL/dW (num - analytic)|: 5.84721565246582e-05
  max |dL/db (num - analytic)|: 0.00011307001113891602
  PASS

[ReLU] forward/backward numeric grad...
  max |dL/dx| diff: 0.00018703937530517578
  PASS

[CrossEntropy] forward/backward numeric grad wrt logits...
  max |dL/dlogits| diff: 0.00014224275946617126
  PASS

[Conv2D] forward shape check...
  PASS

[Conv2D] backward numeric grads (sampled)...
  max |dL/dx| diff: 0.0005117803812026978
  max |dL/dW| diff: 0.0006861686706542969
  PASS

[MaxPool2D] forward vs F.max_pool2d...
  max |y - y_ref|: 0.0
  PASS

[MaxPool2D] backward numeric grads...
  max |dL/dx| diff: 4.225969314575195e-05
  PASS

[E2E] small CNN forward shape...
  PASS

[E2E] tiny training sanity: loss should drop...
  epoch1: loss=2.2131, acc=0.039
  epoch2: loss=1.9477, acc=0.266
  PASS

ALL TESTS PASSED (within numeric tolerances)
==========================
Tests completed. Starting CNN training...
Device: cuda
Training set: torch.Size([48000, 1, 28, 28]), torch.Size([48000])
Validation set: torch.Size([12000, 1, 28, 28]), torch.Size([12000])
Test set: torch.Size([10000, 1, 28, 28]), torch.Size([10000])
CNN from Scratch - Assignment
==================================================
Building CNN...
Starting training...
Total parameters: 9098
GPU memory allocated: 210.6 MB
GPU memory reserved: 212.0 MB

=== Starting Epoch 1/5 ===
Epoch 1/5: train_loss=1.9249 train_acc=0.4271 val_loss=1.3378 val_acc=0.6769

=== Starting Epoch 2/5 ===
Epoch 2/5: train_loss=0.8459 train_acc=0.7806 val_loss=0.5704 val_acc=0.8421

=== Starting Epoch 3/5 ===
Epoch 3/5: train_loss=0.4740 train_acc=0.8664 val_loss=0.4213 val_acc=0.8795

=== Starting Epoch 4/5 ===
Epoch 4/5: train_loss=0.3759 train_acc=0.8911 val_loss=0.3640 val_acc=0.8921

=== Starting Epoch 5/5 ===
Epoch 5/5: train_loss=0.3278 train_acc=0.9045 val_loss=0.3222 val_acc=0.9076

Training curves saved to training_curves_20251006_211440.png

Final Test Results: loss 0.2916 | acc 0.9173
CNN Training completed at:  Mon Oct 6 21:14:42 EDT 2025
\n==========================
Starting ResNet-18 fine-tuning on EMNIST...
Device: cuda
GPU: NVIDIA L4
Image size: torch.Size([3, 224, 224])
Dataset length: 697932
Training dataset size: 628138
Validation dataset size: 69794
Test dataset size: 116323
Batch size: 128
Output directory: ./output_20251006_211456

======================================================================
REGIME 1: LINEAR PROBE (Freeze backbone, train only FC)
======================================================================
Frozen backbone. Trainable params: 0.03M

======================================================================
Training Regime: Regime 1: Linear Probe
Mixed Precision (AMP): Enabled
Early Stopping: Enabled (patience=5)
======================================================================
Epoch [1/15] LR: 0.010000 | Train Loss: 0.8154, Train Acc: 76.11% | Val Loss: 0.6665, Val Acc: 78.93%
Epoch [2/15] LR: 0.010000 | Train Loss: 0.6547, Train Acc: 79.39% | Val Loss: 0.6519, Val Acc: 78.73%
Epoch [3/15] LR: 0.010000 | Train Loss: 0.6328, Train Acc: 79.93% | Val Loss: 0.6228, Val Acc: 79.99%
Epoch [4/15] LR: 0.010000 | Train Loss: 0.6240, Train Acc: 80.14% | Val Loss: 0.6416, Val Acc: 78.90%
Epoch [5/15] LR: 0.001000 | Train Loss: 0.6191, Train Acc: 80.25% | Val Loss: 0.6134, Val Acc: 80.27%
Epoch [6/15] LR: 0.001000 | Train Loss: 0.5857, Train Acc: 81.47% | Val Loss: 0.5949, Val Acc: 81.14%
Epoch [7/15] LR: 0.001000 | Train Loss: 0.5845, Train Acc: 81.57% | Val Loss: 0.5964, Val Acc: 81.09%
Epoch [8/15] LR: 0.001000 | Train Loss: 0.5843, Train Acc: 81.57% | Val Loss: 0.5950, Val Acc: 81.05%
Epoch [9/15] LR: 0.001000 | Train Loss: 0.5842, Train Acc: 81.62% | Val Loss: 0.5967, Val Acc: 81.08%
Epoch [10/15] LR: 0.000100 | Train Loss: 0.5841, Train Acc: 81.60% | Val Loss: 0.5954, Val Acc: 81.11%
Epoch [11/15] LR: 0.000100 | Train Loss: 0.5809, Train Acc: 81.72% | Val Loss: 0.5932, Val Acc: 81.21%
Epoch [12/15] LR: 0.000100 | Train Loss: 0.5809, Train Acc: 81.74% | Val Loss: 0.5915, Val Acc: 81.26%
Epoch [13/15] LR: 0.000100 | Train Loss: 0.5806, Train Acc: 81.76% | Val Loss: 0.5923, Val Acc: 81.23%
Epoch [14/15] LR: 0.000100 | Train Loss: 0.5805, Train Acc: 81.74% | Val Loss: 0.5935, Val Acc: 81.25%
Epoch [15/15] LR: 0.000010 | Train Loss: 0.5808, Train Acc: 81.75% | Val Loss: 0.5921, Val Acc: 81.26%

Training completed in 92.62 minutes
Epochs trained: 15/15
Best validation accuracy: 81.26%

Regime 1 Test Results:
  Accuracy: 81.30%
  Precision: 0.7110
  Recall: 0.6568
  F1-Score: 0.6656
Saved: ./output_20251006_211456/regime1_linear_probe/training_curves.png
Saved: ./output_20251006_211456/regime1_linear_probe/confusion_matrix.png
Saved: ./output_20251006_211456/regime1_linear_probe/results_summary.txt

======================================================================
REGIME 2: PARTIAL UNFREEZE (Unfreeze layer4 + FC from start)
======================================================================
Unfroze layer4. Trainable params: 11.21M

======================================================================
Training Regime: Regime 2: Partial Unfreeze
Mixed Precision (AMP): Enabled
Early Stopping: Enabled (patience=5)
Learning Rate Warmup: 3 epochs
======================================================================
Epoch [1/20] LR: 0.000667 | Train Loss: 0.7380, Train Acc: 80.12% | Val Loss: 0.4115, Val Acc: 85.81%
Epoch [2/20] LR: 0.001000 | Train Loss: 0.3810, Train Acc: 86.46% | Val Loss: 0.3567, Val Acc: 86.90%
Epoch [3/20] LR: 0.001000 | Train Loss: 0.3462, Train Acc: 87.23% | Val Loss: 0.3403, Val Acc: 87.34%
Epoch [4/20] LR: 0.000994 | Train Loss: 0.3261, Train Acc: 87.82% | Val Loss: 0.3321, Val Acc: 87.43%
Epoch [5/20] LR: 0.000976 | Train Loss: 0.3132, Train Acc: 88.20% | Val Loss: 0.3230, Val Acc: 87.93%
Epoch [6/20] LR: 0.000946 | Train Loss: 0.3036, Train Acc: 88.49% | Val Loss: 0.3239, Val Acc: 87.74%
Epoch [7/20] LR: 0.000905 | Train Loss: 0.2955, Train Acc: 88.74% | Val Loss: 0.3174, Val Acc: 88.13%
Epoch [8/20] LR: 0.000854 | Train Loss: 0.2877, Train Acc: 89.05% | Val Loss: 0.3175, Val Acc: 88.01%
Epoch [9/20] LR: 0.000794 | Train Loss: 0.2801, Train Acc: 89.25% | Val Loss: 0.3204, Val Acc: 87.95%
Epoch [10/20] LR: 0.000727 | Train Loss: 0.2727, Train Acc: 89.53% | Val Loss: 0.3169, Val Acc: 88.09%
Epoch [11/20] LR: 0.000655 | Train Loss: 0.2648, Train Acc: 89.82% | Val Loss: 0.3192, Val Acc: 87.98%
Epoch [12/20] LR: 0.000578 | Train Loss: 0.2567, Train Acc: 90.09% | Val Loss: 0.3170, Val Acc: 88.08%

Early stopping triggered at epoch 12
No improvement for 5 epochs

Training completed in 110.00 minutes
Epochs trained: 12/20
Best validation accuracy: 88.13%

Regime 2 Test Results:
  Accuracy: 88.14%
  Precision: 0.8246
  Recall: 0.7647
  F1-Score: 0.7706
Saved: ./output_20251006_211456/regime2_partial_unfreeze/training_curves.png
Saved: ./output_20251006_211456/regime2_partial_unfreeze/confusion_matrix.png
Saved: ./output_20251006_211456/regime2_partial_unfreeze/results_summary.txt

======================================================================
GENERATING COMPARISON REPORTS
======================================================================
Saved: ./output_20251006_211456/regime_comparison.png
Saved: ./output_20251006_211456/regime_comparison_summary.txt

================================================================================
FINAL COMPARISON TABLE
================================================================================
Regime                         Test Acc     Params (M)   Epochs     Time (min)  
--------------------------------------------------------------------------------
Regime 1: Linear Probe              81.30%       0.03M       15      92.62
Regime 2: Partial Unfreeze          88.14%      11.21M       12     110.00
================================================================================

Accuracy improvement (Regime 2 - Regime 1): +6.85%
Additional training time: +17.38 min
Additional trainable params: +11.18M

======================================================================
TRAINING COMPLETE
Results saved to: ./output_20251006_211456/
======================================================================
ResNet Training completed at:  Tue Oct 7 00:39:42 EDT 2025
